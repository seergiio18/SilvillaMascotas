{% extends 'base.html.twig' %}

{% block title %}
    <title>Silvilla Mascotas-Productos</title>
{% endblock %}

{% block body %}
{% include 'base.html.twig' %}
<link rel="stylesheet" href="{{ asset('css/style2.css') }}">
<style>
.imagen {
    object-fit: cover;
    max-height: 350px;
}
</style>
<div class="subhead">
    <h2 class="subtext">Productos</h2>
</div>
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="row justify-content-between">
                <div class="col-auto">
                    <ul class="nav nav-pills">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownPerroComida" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: #ff9b00;">
                                Perro Comida
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdownPerroComida">
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Perro-Comida'}) }}">Todos</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><span class="dropdown-header">Filtrar por marca:</span></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Perro-Comida', 'nombre': 'NOSO'}) }}">O'NOSO</a></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Perro-Comida', 'nombre': 'FRESH'}) }}">FRESH</a></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Perro-Comida', 'nombre': 'ZEN'}) }}">ZEN</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownGatoComida" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: #ff9b00;">
                                Gato Comida
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdownGatoComida">
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida'}) }}">Todos</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><span class="dropdown-header">Filtrar por marca:</span></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida', 'nombre': 'NOSO'}) }}">O'NOSO</a></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida', 'nombre': 'FRESH'}) }}">FRESH</a></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida', 'nombre': 'ZEN'}) }}">ZEN</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownGatoComida" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: #ff9b00;">
                                Perro Cuidados
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdownGatoComida">
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Perro-Cuidado'}) }}">Todos</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><span class="dropdown-header">Filtrar por marca:</span></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida', 'nombre': 'Marca 3'}) }}">Antiparasitarios</a></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida', 'nombre': 'Marca 4'}) }}">Pelo</a></li>
                            </ul>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownGatoComida" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="color: #ff9b00;">
                                Gato Cuidados
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="navbarDropdownGatoComida">
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida'}) }}">Todos</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><span class="dropdown-header">Filtrar por marca:</span></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida', 'nombre': 'Marca 3'}) }}">Antiparasitarios</a></li>
                                <li><a class="dropdown-item" href="{{ path('productos_por_categoria', {'categoria': 'Gato-Comida', 'nombre': 'Marca 4'}) }}">Pelo</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="col-auto">
                    {% if app.user %}
                    <button type="button" class="btn btn-custom verCar" data-bs-toggle="modal" data-bs-target="#exampleModal">Ver carrito</button>
                    {% endif %}
                </div>
                <div id="alert-container" class="mt-2"></div>
            </div>
        </div>
    </div>
</div>



<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Carrito de compra</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <ul class="list-group">
          <table>
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Cantidad</th>
                <th>Precio</th>
              </tr>
            </thead>
            <tbody>
              {% for articulo in articulosCarrito %}
                <tr>
                  <td>{{ articulo.producto.nombre }}</td>
                  <td>{{ articulo.cantidad }}</td>
                  <td>{{ articulo.producto.precio * articulo.cantidad|number_format(2, '.', ',') }}€</td>
                </tr>
              {% endfor %}
              <tr>
                <td colspan="2"><strong>Total:</strong></td>
                <td><strong>{{ totalCarrito|number_format(2, '.', ',') }}€</strong></td>
              </tr>
            </tbody>
          </table>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        <a href="{{ path('carrito') }}" class="btn btn-custom">Ir al carrito</a>
      </div>
    </div>
  </div>
</div>
<div class="container mt-5">
    {% if pagination.getTotalItemCount() == 0 %}
        <p>No se encontraron productos.</p>
    {% else %}
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4 mt-5">
            {% for producto in pagination %}
                <div class="col">
                    <div class="card h-100 position-relative producto-card">
                        <a href="#" style="text-decoration: none; color: black;" class="producto-link" data-nombre="{{ producto.nombre }}" data-imagen="{{ asset('img/' ~ producto.imagen) }}" data-precio="{{ producto.precio }}" data-descripcion="{{ producto.descripcion }}" onclick="mostrarModalProducto(this)" 
                         data-nombre="{{ producto.nombre }}" 
                         data-imagen="{{ asset('img/' ~ producto.imagen ) }}" 
                         data-precio="{{ producto.precio }}" 
                         data-descripcion="{{ producto.descripcion }}">
                            <img src="{{ asset('img/' ~ producto.imagen ) }}" class="card-img-top img-fluid imagen" alt="{{ producto.nombre }}">
                            <div class="card-body">
                                <h5 class="card-title">{{ producto.nombre }}</h5>
                                <p class="card-text">Precio: {{ producto.precio }}€</p>
                            </div>
                        </a>
                        {% if app.user %}
                        <div class="card-footer text-end">
                            <form class="add-to-cart-form" action="{{ path('add_to_cart', {id: producto.id}) }}" method="post">
                                <button type="submit" class="btn btn-custom addToCart">Añadir al carrito</button>
                            </form>
                        </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% endif %}
</div>


<div class="modal fade" id="productoModal" tabindex="-1" aria-labelledby="productoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="productoModalLabel">Detalle del producto</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Aquí se llenará con la información del producto -->
        <div id="productoModalContent"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>



<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="m-5 mx-auto">
                {{ knp_pagination_render(pagination) }}
            </div>
        </div>
    </div>
</div>

<div class="post"></div>
    <div class="container">
      <hr>
      <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4">
        <div class="col-md-4 d-flex align-items-center">
          <span class="mb-3 mb-md-0 text-body-secondary">© 2023 Company, Inc</span>
        </div>
    
        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">
          <li class="ms-3"><a class="text-body-secondary" href="https://www.instagram.com/silvillamascotas" target="_blank"><img class="bi" width="40" height="40" src="{{asset('img/instagram.png')}}" alt="Logo instagram"></a></li>
          <li class="ms-3"><a class="text-body-secondary" href="https://twitter.com" target="_blank"><img class="bi" width="40" height="40" src="{{asset('img/gorjeo.png')}}" alt="Logo twitter"></img></a></li>
          <li class="ms-3"><a class="text-body-secondary" href="https://www.facebook.com" target="_blank"><img class="bi" width="40" height="40" src="{{asset('img/facebook.png')}}" alt="Logo facebook"></img></a></li>
        </ul>
      </footer>
    </div>


{% endblock %}

{% block javascripts %}
<script src="{{ asset('js/bootstrap.bundle.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.add-to-cart-form').forEach(function (form) {
        form.addEventListener('submit', function (e) {
            e.preventDefault();
            const formData = new FormData(form);
            const actionUrl = form.getAttribute('action');

            fetch(actionUrl, {
                method: 'POST',
                body: formData,
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('success', data.success);
                    // Recarga la página después de 1 segundo
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else if (data.error) {
                    showAlert('danger', data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showAlert('danger', 'Error al agregar el producto al carrito');
            });
        });
    });

    function showAlert(type, message) {
        const alertContainer = document.getElementById('alert-container');
        const alertElement = document.createElement('div');
        alertElement.className = `alert alert-${type} alert-dismissible fade show`;
        alertElement.role = 'alert';
        alertElement.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        `;
        alertContainer.appendChild(alertElement);
    }
});


function mostrarModalProducto(element) {
    const nombre = element.getAttribute('data-nombre');
    const imagen = element.getAttribute('data-imagen');
    const precio = element.getAttribute('data-precio');
    const descripcion = element.getAttribute('data-descripcion');

    const modalTitle = document.getElementById('productoModalLabel');
    const modalContent = document.getElementById('productoModalContent');

    // Configura el título y el contenido del modal con la información del producto
    modalTitle.textContent = 'Información del producto';
    modalContent.innerHTML = `
        <img src="${imagen}" class="img-fluid mb-3 float-start me-3" style="width: 200px;" alt="${nombre}">
        <div class="text-start">
          <p style="font-size: 24px;"><strong>${nombre}</strong></p>
          <p style="font-size: 18px;">${descripcion}</p>
          <p style="font-size: 30px;"><strong>${precio}€</strong></p>
        </div>
    `;

    // Muestra el modal
    const productoModal = new bootstrap.Modal(document.getElementById('productoModal'));
    productoModal.show();
}

</script>
{% endblock %}
